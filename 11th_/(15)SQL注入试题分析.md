[TOC]

![]((15)SQL注入试题分析_files/60f7db7a-adbb-4231-b4ea-2a413f9cf5fe.png)

## login.php
![]((15)SQL注入试题分析_files/699e5542-c326-41ac-b34b-745362d2eb75.jpg)

进入2003这个服务器里面,找到login.php这个网页;
找到提交的变量名:
`name = usernm`
`name = passwd`

登录验证的页面:
## loginAuth.php:


![]((15)SQL注入试题分析_files/7f89cc66-a58b-448a-93c0-013332c52420.jpg)

首先是连接数据库;
然后判断是否连接的上,如果连接不上,就退出;
![]((15)SQL注入试题分析_files/aeae4489-50e7-4df4-b431-594569173066.jpg)
打开数据库;用or连接,如果前边这一句话执行的不成功,就执行后边这一句话;
下面一句把查询语句复制给了sql变量;查询里面我们输入的变量都放在一对单引号里面,这里极有可能是文本型注入;
下面一句使用mysql_query进行查询;如果执行不成功就执行exit；**mysql_query这个函数查询的结果是个结果集!**
**必须通过各种方法获得结果集里面的数据;
mysql_num_rows这个方法是用来判断这个结果集里面有几行数据;结果不为0,就证明结果集里面有数据,
head是一个跳转,通过这个语句，可以把当前网页跳转至另外一个网页上去！(Location指明了你要跳转的那个网页上去!)**


## success.php
![]((15)SQL注入试题分析_files/4804cf51-c60a-4520-99d4-bd59ad3178c9.jpg)
这个里面就是一个超链接


## list.html
![]((15)SQL注入试题分析_files/6588313c-8619-48dc-9389-e2d699994fe4.jpg)
![]((15)SQL注入试题分析_files/f0ee6dd4-4c86-432d-ad14-d036b39eb4c9.jpg)
主要做了一些超链接;



## sql注入的密码绕过渗透测试

![]((15)SQL注入试题分析_files/85ba38e1-b42b-411f-a33e-f115095c6bf3.jpg)
主要是闭合前面的单引号;
![]((15)SQL注入试题分析_files/7f6babec-3dde-4381-a045-e14dc0134d40.jpg)

`user =''`这是一个假值,or 1=1这是一个真值，然后注释符号-- 闭合了单引号,同事后边的and语句也没有起到作用;
另外一种方法:
![]((15)SQL注入试题分析_files/e4e02345-badf-41fe-85fe-b5ba7e726fca.jpg)

1-4依次为假or真or真and假
最后为一个真值(10'00"),这是密码绕过；
这场用户名为注入代码,passwd为任意的！这里是用任意的密码去登录!!!

而这里的要求是在passwd这里构造注入代码！(用户名任意)
and 的优先级 比 or 高

![]((15)SQL注入试题分析_files/4c993dd8-547f-40c9-b742-51e1120037ce.jpg)

假 or 真  and 假  (先算and，最后的结果为假),所以这里查不出什么结果;
![]((15)SQL注入试题分析_files/acae695a-7c3e-4f1f-b3e2-fe4f9e79b7ed.jpg)
但是如果把注入的代码`*`放入到后面的语句里面,

![]((15)SQL注入试题分析_files/d91d7ecb-3709-42a0-a2fe-083d7485fdf2.jpg)

此时为:假 and 假 or 真;结果为真;

![]((15)SQL注入试题分析_files/78d76fee-33c1-4c3a-a276-9aac881b7632.jpg)

```
' or 1=1 --
' or 1=1 or 1 ='1
' or 1 ='1
```
密码框里面的注入代码(上面两个在密码框和用户名里面填写都可以实现绕过,第三个只能填写密码框才能实现绕过)
即：上面两句注入语句不管写在用户名还是密码框里面的时候,它都可以绕过,比如：如果第一句写在usernamer里面的时候,可以实现密码绕过(密码随便写),第一句写在passwd里面的时候，可以实现用户名绕过(用户名随便写);其他依次类推;

![]((15)SQL注入试题分析_files/df50168a-d889-4464-87bf-aa689a05a232.jpg)

1.`is_numeric`这个函数用于防御数字 型注入;
2.2和3这两个函数一般用于防御字符型注入,3这个函数只能用于mysql这种数据库,可以用addslashes这个函数;

![]((15)SQL注入试题分析_files/cb17adab-1449-4300-8486-d9a16151365b.jpg)
addslash()的作用是自动添加反斜杠;
(这里还可以(就是还可以被sql注入了)是因为在sqlserver里面转义符号不是反斜杠)，这里认为你输入的用户名就是反斜杠,这跟你不输入或者输入any一样效果;
后面不能注入不是你把它单引号 转义了,而是那个反斜杠引起了语法错误;


![]((15)SQL注入试题分析_files/fbc1c79e-ea86-43fc-91df-c8fd4fd135f7.jpg)
他这里的答案不能绕过了;
也有些错误;header是不允许有echo这个语句的,否则会报错！将这两者顺序改一改;(其实这里只是防止绕过,还有其他漏洞！！)


![]((15)SQL注入试题分析_files/bd637f6b-0ca9-4ca1-a072-24534473cf84.jpg)

![]((15)SQL注入试题分析_files/a253bccf-9d03-4fb4-81f2-94c80bb8cf36.jpg)
![]((15)SQL注入试题分析_files/8d145e11-be98-4439-bc81-ed356a93fc37.jpg)
str_replace(" ' "," ",$username)；
这里是把$username里面有没有字符`'`,有的话就换成空的字符;(就是把敏感的字符替换掉)；


