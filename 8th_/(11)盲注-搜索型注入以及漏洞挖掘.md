[TOC]

## 漏洞的产生以及原因
![]((11)盲注-搜索型注入以及漏洞挖掘_files/fbcc8496-a433-4097-8f44-f7f14b7d8a90.jpg)
这是模糊查询,只要first_name字段里面有a,就会符合查询的条件;



![]((11)盲注-搜索型注入以及漏洞挖掘_files/fa341428-8676-4e3d-860d-d45634312442.png)

![]((11)盲注-搜索型注入以及漏洞挖掘_files/34bea7f7-6971-408c-808a-a199d763a3c7.png)


![]((11)盲注-搜索型注入以及漏洞挖掘_files/0d0e948d-28a8-483c-85f3-3cdfa791b900.jpg)

%代表任意数量的任意字符;
_代表任意单个的任意字符；



![]((11)盲注-搜索型注入以及漏洞挖掘_files/043bc0d8-556a-4171-821a-8d9d79c166ad.jpg)

这里实验的数据库里面的总共的条目有5条！(可以参考sql注入(中级))
![]((11)盲注-搜索型注入以及漏洞挖掘_files/d6005604-037b-40d6-aa81-5bf84a700383.png)



![]((11)盲注-搜索型注入以及漏洞挖掘_files/fa894e2a-7a4c-4247-a317-13f0d8691f9f.png)

![]((11)盲注-搜索型注入以及漏洞挖掘_files/0dbac98e-a08e-4e48-8760-0e507958f955.png)


![]((11)盲注-搜索型注入以及漏洞挖掘_files/6d051d32-7255-4767-8b5b-405a9353c350.png)

8'40"
![]((11)盲注-搜索型注入以及漏洞挖掘_files/1f2ae735-e869-4965-8284-7ac4c0a24e4e.jpg)


在下面这个查询 语句里面:
![]((11)盲注-搜索型注入以及漏洞挖掘_files/9e4ae40a-48d8-4329-a8df-6eb2b0318a70.jpg)
我们输入的语句就在$id这个地方，我们会把输入的语句带入到这个地方;
首先会考虑把单引号和百分号闭合掉,后面那个百分号和单引号可以注视掉!只要闭合前边就可以!


只是输入a:

![]((11)盲注-搜索型注入以及漏洞挖掘_files/7bba9f25-b4ae-447f-95e1-bdba1cd7938e.png)

输入:`a%' and 1=1 #`,这里的%'是和之前的进行闭合的!#进行注释！！！
如果执行的结果和之前上面一幅图的结果是一样的,那么证明是把这个语句带入数据库查询和执行了!

![]((11)盲注-搜索型注入以及漏洞挖掘_files/b0e06753-d239-4cfe-92b4-bd14e5dbe7df.png)

![]((11)盲注-搜索型注入以及漏洞挖掘_files/c6255c2c-64aa-4f27-b3f9-2f4a1bfb9156.png)
以上证明这就是一个注入点了
10'50"(主要是利用引号闭合了)

## 挖掘漏洞

![]((11)盲注-搜索型注入以及漏洞挖掘_files/1e94ee17-37e2-4abe-87da-47b141c71710.jpg)

1.找到哪些地方是用户输入的数据;然后看一看,它有没有把数据都处理；
代码里面负责获取用户 数据的变量:`$_GET,$_POST,$COOKIE,$_SERVICER`;

2.负责执行数据库查询操作的函数:`mysql_query()`
在操作这个函数之前操作的数据是用户输入的还是本身提供的,如果是用户输入的就要检查一下有没有做处理,主要就是看这个程序里对用户输入 的数据有没有做处理,如果没有处理,直接带入 到数据库里面执行,那么一般就会存在漏洞!

![]((11)盲注-搜索型注入以及漏洞挖掘_files/826b0228-5507-478d-ab22-823deaadc1ec.jpg)



![]((11)盲注-搜索型注入以及漏洞挖掘_files/3208e894-8226-476a-91f8-1f310c482561.jpg)

找到包含mysql_query相关页面:

![]((11)盲注-搜索型注入以及漏洞挖掘_files/5fb01ad0-7e4b-4f10-bc9f-2ab09c3617fe.jpg)

得到了网站的源代码,,而后去搜,搜获取用户的变量,搜执行数据库查询的函数;
![]((11)盲注-搜索型注入以及漏洞挖掘_files/9e7dd524-92a5-475e-9652-b5e0a3a1ef17.jpg)

Mysql_query()函数是执行查询的,要处理数据,应该是在这个函数之前:
![]((11)盲注-搜索型注入以及漏洞挖掘_files/ff979306-2bc9-4aae-85d5-be32445074bb.jpg)

`$_POST`是接收数据,

![]((11)盲注-搜索型注入以及漏洞挖掘_files/fcc4f7ce-9b42-4f16-aeac-773ff515e124.jpg)
`stripslashes`是去掉由魔法引号反斜杠函数；

![]((11)盲注-搜索型注入以及漏洞挖掘_files/b7ccf40e-dd5e-46f3-9caa-de82dc8a8b9c.jpg)

mysql_real_escape_string()函数:
添加反斜杠进行转义

![]((11)盲注-搜索型注入以及漏洞挖掘_files/89e73e58-a854-4233-a260-66c01342cf89.jpg)

用Md5进行加密;

![]((11)盲注-搜索型注入以及漏洞挖掘_files/0bae6fb0-c1ef-4ab8-9fb7-c005e4a9d24d.jpg)

查询语句的时候既判断用户名,也判断密码;而且用户名和密码都是作为文本型数据存放于这里;

![]((11)盲注-搜索型注入以及漏洞挖掘_files/d93996a2-87ac-48c2-ab33-ce793e9c3bac.jpg)

执行查询,mysql_query()前面有一个@符号是抑制错误信息的;

![]((11)盲注-搜索型注入以及漏洞挖掘_files/b92114ab-7507-4fbe-9b02-ca9a4207b139.jpg)

有两个条件,1.$result里面必须得有值;
```
mysql_num_rows($result)==1
```
2.在`$result`这个变量里面,它的结果集是几行,这里要求是一行;

